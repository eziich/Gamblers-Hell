@page "/mamoon"
@using GamblersHell.Client.StateProviders
@using GamblersHell.Shared
@using GamblersHell.Client.Services
@using GamblersHell.Client.Pages.Components
@using Microsoft.AspNetCore.Components.Authorization
@using Microsoft.AspNetCore.Authorization
@inject UserService UserService
@inject NavigationManager NavigationManager
@inject AuthenticationStateProvider AuthenticationStateProvider
@attribute [Authorize]

<PageTitle>Mamoon @GamblersHellConstants.DeafultPageName</PageTitle>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/ScrollsHighRank.css">
</head>

<style>
    body {
        background-image: linear-gradient(180deg, #000000, #000000, #000000, #0a0a0a, #00121a, #00293d);
        background-attachment: fixed;
    }

    .satan-container {
        animation: glow 3s infinite alternate;
    }

    .title-text {
        font-family: 'Cinzel', serif;
        text-shadow: 0 0 10px rgba(0, 153, 255, 0.8);
        letter-spacing: 2px;
    }

    .scroll {
        background-image: radial-gradient(circle, #00293d, #00121a, #0a0a0a, #000000);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 0 15px rgba(0, 153, 255, 0.5);
        padding: 2rem;
        border: 2px solid #99ccff;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

        .scroll:hover {
            box-shadow: 0 0 20px rgba(0, 153, 255, 0.8);
        }

    .scroll-text {
        color: #99ccff;
    }

    .satan-image {
        filter: contrast(1.2) saturate(1.2);
        transition: all 0.3s ease;
        border-radius: 4px;
        animation: float 6s ease-in-out infinite;
    }

    @@keyframes glow {
        0% {
            filter: drop-shadow(0 0 2px rgba(0, 153, 255, 0.7));
        }

        100% {
            filter: drop-shadow(0 0 15px rgba(0, 153, 255, 0.9));
        }
    }

    @@keyframes float {
        0% {
            transform: translateY(0px);
        }

        50% {
            transform: translateY(-20px);
        }

        100% {
            transform: translateY(0px);
        }
    }

    .warning-text {
        background-color: rgba(0, 41, 61, 0.6);
        border-radius: 4px;
        padding: 1rem;
        border: 1px solid #99ccff;
        box-shadow: 0 0 10px rgba(0, 153, 255, 0.5);
    }
</style>

@if (_pageLoading)
{
    <LoadingPageComponent />
}
else
{
    @if (UserModel.Level < 4)
    {
        <AnticheatSite />
    }
    else
    {
        @if (_accountVerified == 0)
        {
            <VerificationNotificationComponent />
            <UserNotVerifiedHellInteraction />
        }
        else
        {
            <MudItem Class="d-flex flex-column min-vh-100 align-items-center align-content-center justify-content-center my-1">
                <MudContainer Class="scroll-container">
                    <MudContainer Class="scroll">
                        <MudContainer Class="scroll-text d-flex flex-column justify-content-center align-items-center">
                            <MudImage Src="Demons/Greed.png" Width="300" Height="300"></MudImage>
                            <MudText Typo="Typo.h3">MAMOON</MudText>
                            <MudText Align="Align.Center" Typo="Typo.h5" Class="my-4">
                                <i>
                                    <span>
                                        "Demon of The Cursed Gold"
                                    </span>
                                </i>
                            </MudText>
                            <MudText Class="mt-2 mb-5" Typo="Typo.body1" Align="Align.Center">
                                <i>
                                    <span>
                                        Mammon is the demon of Greed, cursed by his obsession with gold and wealth.
                                        His appearance is that of a vast, oceanic creature, his body composed of gold coins, treasures, and precious stones that constantly shift and pulse with wealth.
                                        His eyes glimmer with an endless, rapacious hunger, ever-searching for more riches.
                                        His domain is a glittering, sea-like expanse, but this ocean is not one of freedom or fortune—rather, it is a prison, constantly shifting with piles of cursed coins that reflect Mammon’s curse.
                                        Mammon’s obsession with gold has trapped him in an endless, futile cycle. While he once reveled in hoarding wealth, now he is surrounded by it, drowning in it, and unable to escape his own desire for more.
                                        His game reflects this unrelenting hunger—a game of chance and risk where the player must engage with Mammon’s curse of greed in order to win.
                                    </span>
                                </i>
                            </MudText>
                        </MudContainer>
                    </MudContainer>
                </MudContainer>

                <MudItem Class="d-flex justify-content-center align-items-center mt-auto w-100">
                    <PageFooter />
                </MudItem>
            </MudItem>
        }
    }
}

@code {
    private int _id { get; set; }
    private int _accountVerified { get; set; }
    private bool _userWonFinalgame => UserModel.BalanceAfterWin > 0;
    public bool _pageLoading = true;

    private UserDTO UserModel { get; set; } = new();

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;

        if (user.Identity.IsAuthenticated)
        {
            _id = Convert.ToInt32(user.FindFirst(u => u.Type == nameof(UserDTO.ID)).Value);
            _accountVerified = Convert.ToInt32(user.FindFirst(u => u.Type == "UserVerified")?.Value ?? "0");
            try
            {
                UserModel = await UserService.GetUserByID(_id);
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }
        else
        {
            _id = 0;
        }
        _pageLoading = false;
        StateHasChanged();
    }
}
